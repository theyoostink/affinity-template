<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Affinity Auto-Battler Template</title>
	<style type="text/css">
		@font-face {
			font-family: FEHFont;
			src: url(css/FEHFont.ttf);
		}
		body {
			background-color: black;
			color: white;
			font-family: FEHFont, Arial, sans-serif;
		}
		#canvas-container {
			float: left;
			position: relative;
			margin: 0 auto;
			display: block;
			border: 1px black solid;
			background-color: #02232e;
			width: 1000px;
			height: 500px;
			font-family: FEHFont;
		}
		#canvas {
			width: 100%;
			height: 100%;
			background-color: #02232e;
		}
		#left-character-img {
			position: absolute;
			background-image: url("images/lucina_positive.png");
			background-repeat: no-repeat;
  			background-size: cover;
			top: 108px;
			left: 0px;
			width: 450px;
			height: 284px;
			box-shadow: 0 0 20px 20px #02232e inset;
			mask-image: radial-gradient(ellipse, #02232e 30%, transparent 100%);
		}
		#right-character-img {
			position: absolute;
			background-image: url("images/lucina_negative.png");
			background-repeat: no-repeat;
  			background-size: cover;
			top: 108px;
			left: 550px;
			width: 450px;
			height: 284px;
			transform: scaleX(-1);
			box-shadow: 0 0 20px 20px #02232e inset;
			mask-image: radial-gradient(ellipse, #02232e 30%, transparent 100%);
		}
		#left-character-arrow {
			position: absolute;
			background-image: url("images/verypositive_lr.png");
			background-repeat: no-repeat;
  			background-size: cover;
  			top: 170px;
			left: 400px;
			width: 200px;
			height: 47px;
		}
		#right-character-arrow {
			position: absolute;
			background-image: url("images/negative_rl.png");
			background-repeat: no-repeat;
  			background-size: cover;
  			top: 290px;
			left: 400px;
			width: 200px;
			height: 47px;
		}
		#left-character-bubble {
			position: absolute;
			background-image: url("images/verypositive_left_long.png");
			background-repeat: no-repeat;
			background-size: cover;
  			top: 40px;
			left: 50px;
			width: 375px;
			height: 90px;
		}
		#right-character-bubble {
			position: absolute;
			background-image: url("images/negative_right_long.png");
			background-repeat: no-repeat;
			background-size: cover;
  			bottom: 40px;
			right: 50px;
			width: 375px;
			height: 90px;
		}
		#left-character-quote-text {
			display: table;
			margin: 0 auto;
			padding-top: 10px;
			text-shadow: rgb(0, 0, 0) 3px 0px 0px, rgb(0, 0, 0) 2.83487px 0.981584px 0px, rgb(0, 0, 0) 2.35766px 1.85511px 0px, rgb(0, 0, 0) 1.62091px 2.52441px 0px, rgb(0, 0, 0) 0.705713px 2.91581px 0px, rgb(0, 0, 0) -0.287171px 2.98622px 0px, rgb(0, 0, 0) -1.24844px 2.72789px 0px, rgb(0, 0, 0) -2.07227px 2.16926px 0px, rgb(0, 0, 0) -2.66798px 1.37182px 0px, rgb(0, 0, 0) -2.96998px 0.42336px 0px, rgb(0, 0, 0) -2.94502px -0.571704px 0px, rgb(0, 0, 0) -2.59586px -1.50383px 0px, rgb(0, 0, 0) -1.96093px -2.27041px 0px, rgb(0, 0, 0) -1.11013px -2.78704px 0px, rgb(0, 0, 0) -0.137119px -2.99686px 0px, rgb(0, 0, 0) 0.850987px -2.87677px 0px, rgb(0, 0, 0) 1.74541px -2.43999px 0px, rgb(0, 0, 0) 2.44769px -1.73459px 0px, rgb(0, 0, 0) 2.88051px -0.838247px 0px;
			font-weight: bold;
			font-size: 26px;
			text-align: center;
		}
		#right-character-quote-text {
			display: table;
			margin: 0 auto;
			padding-top: 34px;
			text-shadow: rgb(0, 0, 0) 3px 0px 0px, rgb(0, 0, 0) 2.83487px 0.981584px 0px, rgb(0, 0, 0) 2.35766px 1.85511px 0px, rgb(0, 0, 0) 1.62091px 2.52441px 0px, rgb(0, 0, 0) 0.705713px 2.91581px 0px, rgb(0, 0, 0) -0.287171px 2.98622px 0px, rgb(0, 0, 0) -1.24844px 2.72789px 0px, rgb(0, 0, 0) -2.07227px 2.16926px 0px, rgb(0, 0, 0) -2.66798px 1.37182px 0px, rgb(0, 0, 0) -2.96998px 0.42336px 0px, rgb(0, 0, 0) -2.94502px -0.571704px 0px, rgb(0, 0, 0) -2.59586px -1.50383px 0px, rgb(0, 0, 0) -1.96093px -2.27041px 0px, rgb(0, 0, 0) -1.11013px -2.78704px 0px, rgb(0, 0, 0) -0.137119px -2.99686px 0px, rgb(0, 0, 0) 0.850987px -2.87677px 0px, rgb(0, 0, 0) 1.74541px -2.43999px 0px, rgb(0, 0, 0) 2.44769px -1.73459px 0px, rgb(0, 0, 0) 2.88051px -0.838247px 0px;
			font-weight: bold;
			font-size: 26px;
			text-align: center;
		}
		#left-controls {
			margin-top: 20px;
			width: 500px;
			float: left;
		}
		#right-controls {
			margin-top: 20px;
			width: 500px;
			float: left;
		}
		#button-container {
			width: 100%;
			float: left;
		}
		#download-button {
			border-radius: 15px;
			padding: 10px;
			margin-top: 40px;
			margin-bottom: 40px;
			font-weight: bold;
		}
		#download-button:hover, #download-button:active {
			background-color: #aaa;
		}
		input[type=text], input[type=number] {
			border-radius: 5px;
			border: none;
		}
		#instructions {
			width: 100%;
			float: left;
		}
		a {
			color: white;
		}
		a:hover, a:active {
			color: yellow;
		}
	</style>
</head>
<body>
<h1>Affinity Auto-Battler Template</h1>

<div id="left-controls">
<label for="left-character-file">Left Character Image File:</label>
<input type="file" id="left-character-file" name="left-character-file" onchange="update()">
<br/>
<span>Left Character Affinity:</span>
<br/>
<input type="radio" id="left-negative" name="left-affinity" value="negative" onchange="update()">
<label for="left-negative">Negative</label><br>
<input type="radio" id="left-positive" name="left-affinity" value="positive" onchange="update()">
<label for="left-positive">Positive</label><br>
<input type="radio" id="left-verypositive" name="left-affinity" value="verypositive" onchange="update()" checked="checked">
<label for="left-verypositive">Very Positive</label>
<br/>
<label for="left-character-quote">Left Character Quote:</label>
<input type="text" id="left-character-quote" name="left-character-quote" value="Eats Hooters wings with" onchange="update()">
<br/>
<label for="left-font">Left Font Size:</label>
<input type="number" name="left-font" id="left-font" value="26" onchange="update()">
<br/>
<label for="left-offset">Left Top Offset:</label>
<input type="number" name="left-offset" id="left-offset" value="10" onchange="update()">
</div>

<div id="right-controls">
<label for="right-character-file">Right Character Image File:</label>
<input type="file" id="right-character-file" name="right-character-file" onchange="update()">
<br/>
<span>Right Character Affinity:</span>
<br/>
<input type="radio" id="right-negative" name="right-affinity" value="negative" onchange="update()" checked="checked">
<label for="right-negative">Negative</label><br>
<input type="radio" id="right-positive" name="right-affinity" value="positive" onchange="update()">
<label for="right-positive">Positive</label><br>
<input type="radio" id="right-verypositive" name="right-affinity" value="verypositive" onchange="update()">
<label for="right-verypositive">Very Positive</label>
<br/>
<label for="right-character-quote">Right Character Quote:</label>
<input type="text" id="right-character-quote" name="right-character-quote" value="Considers cringe" onchange="update()">
<br/>
<label for="right-font">Right Font Size:</label>
<input type="number" name="right-font" id="right-font" value="26" onchange="update()">
<br/>
<label for="right-offset">Right Top Offset:</label>
<input type="number" name="right-offset" id="right-offset" value="10" onchange="update()">
</div>

<div id="button-container">
<button id="download-button">Download Image</button>
</div>

<div id="canvas-container">
	<div id="canvas">
		<div id="left-character-img"></div>
		<div id="right-character-img"></div>
		<div id="left-character-arrow"></div>
		<div id="right-character-arrow"></div>
		<div id="left-character-bubble">
			<span id="left-character-quote-text">CRINGE</span>
		</div>
		<div id="right-character-bubble">
			<span id="right-character-quote-text">CRINGE</span>
		</div>
	</div>
</div>

<div id="instructions">
	<h2>Instructions</h2>
	<ol>
		<li>You will have to upload an image file for each character.</li>
		<li>Go to the FEH Fandom wiki page for your character of choice (e.g. <a href="https://feheroes.fandom.com/wiki/Lucina:_Future_Witness">Lucina's hero page</a>).</li>
		<li>Go to the Misc tab near the top of the article (e.g. <a href="https://feheroes.fandom.com/wiki/Lucina:_Future_Witness/Misc">Lucina's misc page</a>).</li>
		<li>Scroll down to the Gallery section. Open the battle portrait image (regular for positive/very positive or damaged for negative).</li>
		<li>Save/download the image. It will be a webp file, but that's okay.</li>
		<li>Enter the webp image file you downloaded to this tool's Image File input.</li>
		<li>You can adjust the font size and vertical offset for the message text. Negative values don't work.</li>
		<li>A list of in-game affinity messages is available <a href="https://feheroes.fandom.com/wiki/Affinity_Auto-Battles">here</a> for reference.</li>
		<li>The Download Image button will save the result as an affinity.png image file.</li>
	</ol>
</div>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.0/FileSaver.min.js"></script>
<script type="text/javascript" src="js/dom-to-image.min.js"></script>
<script type="text/javascript">

/*
	Shout out to https://yeoji.github.io/spritesheet-cutter/
*/

var left_affinity_arrow = {
	"negative": "images/negative_lr.png",
	"positive": "images/positive_lr.png",
	"verypositive": "images/verypositive_lr.png"
};

var right_affinity_arrow = {
	"negative": "images/negative_rl.png",
	"positive": "images/positive_rl.png",
	"verypositive": "images/verypositive_rl.png"
};

var left_affinity_bubble = {
	"negative": "images/negative_left_long.png",
	"positive": "images/positive_left_long.png",
	"verypositive": "images/verypositive_left_long.png"
};

var right_affinity_bubble = {
	"negative": "images/negative_right_long.png",
	"positive": "images/positive_right_long.png",
	"verypositive": "images/verypositive_right_long.png"
};

function update() {
	var left_character_file = document.getElementById("left-character-file").files[0];
	var left_character_file_reader = new FileReader();
	left_character_file_reader.onloadend = function () {
		document.getElementById("left-character-img").style.backgroundImage="url("+left_character_file_reader.result+")";
	};
	if (left_character_file) {
		left_character_file_reader.readAsDataURL(left_character_file);
	}
	else {
		document.getElementById("left-character-img").style.backgroundImage="url('images/lucina_positive.png')";
	}
	var right_character_file = document.getElementById("right-character-file").files[0];
	var right_character_file_reader = new FileReader();
	right_character_file_reader.onloadend = function () {
		document.getElementById("right-character-img").style.backgroundImage="url("+right_character_file_reader.result+")";
	};
	if (right_character_file) {
		right_character_file_reader.readAsDataURL(right_character_file);
	}
	else {
		document.getElementById("right-character-img").style.backgroundImage="url('images/lucina_negative.png')";
	}

	var left_affinity = document.querySelector("input[name='left-affinity']:checked").value;
	var right_affinity = document.querySelector("input[name='right-affinity']:checked").value;

	var left_affinity_arrow_url = left_affinity_arrow[left_affinity];
	var right_affinity_arrow_url = right_affinity_arrow[right_affinity];
	document.getElementById("left-character-arrow").style.backgroundImage="url("+left_affinity_arrow_url+")";
	document.getElementById("right-character-arrow").style.backgroundImage="url("+right_affinity_arrow_url+")";

	var left_affinity_bubble_url = left_affinity_bubble[left_affinity];
	var right_affinity_bubble_url = right_affinity_bubble[right_affinity];
	document.getElementById("left-character-bubble").style.backgroundImage="url("+left_affinity_bubble_url+")";
	document.getElementById("right-character-bubble").style.backgroundImage="url("+right_affinity_bubble_url+")";

	var left_character_quote_text = document.getElementById("left-character-quote").value;
	var right_character_quote_text = document.getElementById("right-character-quote").value;
	document.getElementById("left-character-quote-text").innerHTML=left_character_quote_text;
	document.getElementById("right-character-quote-text").innerHTML=right_character_quote_text;

	var left_font = document.getElementById("left-font").value;
	var left_offset = document.getElementById("left-offset").value;
	document.getElementById("left-character-quote-text").style.fontSize = left_font+"px";
	document.getElementById("left-character-quote-text").style.paddingTop = left_offset+"px";
}

document.getElementById("download-button").addEventListener("click", function() {
	var node = document.getElementById("canvas");
	domtoimage.toBlob(node)
    .then(function (blob) {
		saveAs(blob, "affinity.png");
    })
    .catch(function (error) {
        console.error("Oops, something went wrong!", error);
    });
});

update();

</script>

</body>
</html>